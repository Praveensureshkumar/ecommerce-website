<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Checkout</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body { background: #f5f6f8; }
    .checkout-wrapper { max-width: 980px; margin: 24px auto; }
    .progress-steps { display:flex; gap:8px; margin-bottom:18px; }
    .step { flex:1; padding:10px 12px; background:#eef2ff; color:#6b7280; text-align:center; border-radius:8px; font-weight:600; }
    .step.active { background: linear-gradient(90deg,#0b5ed7,#3b82f6); color:#fff; box-shadow: 0 6px 18px rgba(11,94,215,0.12); }
    .section { background:#fff; border-radius:10px; margin-bottom:14px; overflow:hidden; box-shadow:0 6px 18px rgba(16,24,40,0.04); }
    .section-header { display:flex; align-items:center; gap:12px; padding:14px 18px; cursor:pointer; }
    .section-header .badge-step { background:#eef2ff; color:#0b5ed7; font-weight:700; padding:8px 12px; border-radius:999px; }
    .section-header .title { flex:1; font-size:0.95rem; font-weight:700; color:#111827; }
    .section-body { display:none; padding:18px; border-top:1px solid #f1f5f9; }
    .section.active .section-body { display:block; }
    .continue-btn { background: #0b5ed7; color: white; border: none; padding: 10px 20px; margin-top: 12px; border-radius:8px; }
    .continue-btn[disabled] { opacity:0.6; cursor:not-allowed; }
    .address-error { color:#B00020; font-size:0.9rem; margin-top:8px; display:none; }
    .order-line { display:flex; justify-content:space-between; gap:20px; margin-bottom:8px; }
    .summary-total { display:flex; justify-content:space-between; font-weight:800; font-size:1.05rem; }
    @media (max-width:768px){ .section-header { padding:12px; } .checkout-wrapper { padding: 0 12px; } }
  </style>
</head>
<body>

<div class="checkout-wrapper container">
  <div class="progress-steps">
    <div class="step {% if not user.is_authenticated %}active{% endif %}" id="step-1">1. Login</div>
    <div class="step {% if user.is_authenticated %}active{% endif %}" id="step-2">2. Address</div>
    <div class="step" id="step-3">3. Payment</div>
  </div>

  <div class="section {% if not user.is_authenticated %}active{% endif %}" id="section-login" data-step="1">
    <div class="section-header" onclick="goTo('section-login')">
      <div class="badge-step">1</div>
      <div class="title">Login or Signup</div>
    </div>
    <div class="section-body">
      {% if user.is_authenticated %}
        <p><strong>{{ user.username }}</strong> &nbsp; <small class="text-muted">{{ user.phone_number }}</small></p>
        <button class="continue-btn" onclick="goTo('section-address')">Continue</button>
      {% else %}
        <div class="form-row">
          <div class="col-12 mb-2"><input type="text" class="form-control" placeholder="Enter Email or Mobile"></div>
          <div class="col-12"><button class="continue-btn">Continue</button></div>
        </div>
        <p class="text-muted mt-2">Please login to continue.</p>
      {% endif %}
    </div>
  </div>

  <div class="section {% if user.is_authenticated %}active{% endif %}" id="section-address" data-step="2">
    <div class="section-header" onclick="goTo('section-address')">
      <div class="badge-step">2</div>
      <div class="title">Delivery Address</div>
    </div>
    <div class="section-body">
  <label for="delivery_address" class="form-label">Delivery address</label>
  <textarea id="delivery_address" class="form-control" placeholder="Enter delivery address...">{% if user.is_authenticated and user.customuser.full_address %}{{ user.customuser.full_address }}{% endif %}</textarea>
      <div id="addressError" class="address-error">Please enter a delivery address before continuing.</div>
      <button id="addressContinue" class="continue-btn" onclick="validateAndProceed()">Continue</button>
    </div>
  </div>

  <!-- Order Summary removed as requested -->

  <div class="section" id="section-payment" data-step="3">
    <div class="section-header" onclick="goTo('section-payment')">
      <div class="badge-step">3</div>
      <div class="title">Payment Options</div>
    </div>
    <div class="section-body">
      <p>Select your payment method:</p>
      <ul class="list-unstyled">
        <li><label><input type="radio" name="payment" checked> Cash on Delivery</label></li>
        <li><label><input type="radio" name="payment"> UPI</label></li>
        <li><label><input type="radio" name="payment"> Debit / Credit Card</label></li>
      </ul>
      <button class="continue-btn">Place Order</button>
    </div>
  </div>

</div>

<script>
function setActiveStep(step) {
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  const el = document.getElementById('step-' + step);
  if (el) el.classList.add('active');
}

function goTo(sectionId) {
  // Simple navigation between sections
  document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
  const target = document.getElementById(sectionId);
  if (target) {
    target.classList.add('active');
    const step = target.getAttribute('data-step') || '1';
    setActiveStep(step);
  }
}

function validateAndProceed() {
  const addr = document.getElementById('delivery_address').value.trim();
  const err = document.getElementById('addressError');
  if (!addr) {
    err.style.display = 'block';
    document.getElementById('delivery_address').focus();
    return false; // prevent navigation
  }
  err.style.display = 'none';
  goTo('section-payment');
  return true;
}

// Enhance UX: hide error when user types
document.addEventListener('DOMContentLoaded', function(){
  const addrEl = document.getElementById('delivery_address');
  if (addrEl) {
    addrEl.addEventListener('input', function(){
      const err = document.getElementById('addressError');
      if (this.value.trim()) err.style.display = 'none';
    });
  }
});
</script>

</body>
</html>
